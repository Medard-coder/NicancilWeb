<!-- Mini calendario para cada prenda -->
<div class="prenda-card" data-prenda-id="{{ prenda.id }}">
    <h5>{{ prenda.variante.prenda.nombre }}</h5>
    <div id="calendario-{{ prenda.id }}" class="mini-calendario"></div>
    <div class="disponibilidad-info">
        <span class="badge badge-success" id="status-{{ prenda.id }}">Disponible</span>
        {% if prenda.rentas.exists %}
        <button class="btn btn-sm btn-primary mt-2" onclick="sincronizarRenta({{ prenda.rentas.first.id }})">
            Sincronizar con Google
        </button>
        {% endif %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const prendaId = {{ prenda.id }};
    
    const calendario = new FullCalendar.Calendar(document.getElementById(`calendario-${prendaId}`), {
        initialView: 'dayGridMonth',
        height: 300,
        headerToolbar: {
            left: 'prev,next',
            center: 'title',
            right: ''
        },
        events: `/rentas/api/prenda/${prendaId}/calendario/`,
        
        dateClick: function(info) {
            fetch(`/rentas/api/prenda/${prendaId}/disponibilidad/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    fecha_inicio: info.dateStr,
                    fecha_fin: info.dateStr
                })
            })
            .then(response => response.json())
            .then(data => {
                const status = document.getElementById(`status-${prendaId}`);
                status.textContent = data.mensaje;
                status.className = data.disponible ? 'badge badge-success' : 'badge badge-danger';
            });
        }
    });
    
    calendario.render();
});

function sincronizarRenta(rentaId) {
    fetch(`/rentas/api/renta/${rentaId}/sincronizar/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('¡Sincronizado con Google Calendar!');
        } else {
            alert('Error: ' + data.error);
        }
    })
    .catch(error => {
        alert('Error de conexión: ' + error);
    });
}
</script>

<style>
.mini-calendario {
    max-width: 300px;
    margin: 10px 0;
}

.prenda-card {
    border: 1px solid #ddd;
    padding: 15px;
    margin: 10px;
    border-radius: 8px;
}
</style>