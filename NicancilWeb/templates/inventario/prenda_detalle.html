{% extends 'base_dashboard.html' %}

{% block title %}{{ prenda.nombre }}{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-md-6">
            {% if prenda.imagen %}
                <img src="{{ prenda.imagen.url }}" class="img-fluid rounded" alt="{{ prenda.nombre }}">
            {% else %}
                <div class="bg-light text-center py-5 rounded">Sin imagen</div>
            {% endif %}
        </div>
        <div class="col-md-6">
            <h2>{{ prenda.nombre }}</h2>
            <p>
                <span class="badge bg-info">{{ prenda.get_tipo_display }}</span>
                <span class="badge bg-primary">{{ prenda.get_genero_display }}</span>
                <span class="badge {% if prenda.estatus == 'disponible' %}bg-success{% elif prenda.estatus == 'apartado' %}bg-warning{% else %}bg-danger{% endif %}">
                    {{ prenda.get_estatus_display }}
                </span>
            </p>
            <p class="lead">${{ prenda.precio }}</p>
            <p>{{ prenda.descripcion }}</p>
            
            <div class="row mt-3">
                <div class="col-md-6">
                    <p><strong>Color:</strong> {{ prenda.color|default:"No especificado" }}</p>
                    <p><strong>Tallas:</strong> {{ prenda.tallas|default:"No especificado" }}</p>
                    <p><strong>Ubicación:</strong> {{ prenda.lugar|default:"No especificado" }}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Cantidad:</strong> {{ prenda.cantidad }}</p>
                    <p><strong>Fecha de agregado:</strong> {{ prenda.fecha_creacion|date:"d/m/Y" }}</p>
                </div>
            </div>
            
            {% if user.rol == 'admin' %}
            <div class="mt-4">
                <a href="{% url 'editar_prenda' prenda.pk %}" class="btn btn-warning">Editar</a>
                <a href="{% url 'gestionar_variantes' prenda.pk %}" class="btn btn-info">Gestionar Variantes</a>
                <a href="{% url 'eliminar_prenda' prenda.pk %}" class="btn btn-danger">Eliminar</a>
            </div>
            {% endif %}
            
            <a href="{% url 'prenda_lista' %}" class="btn btn-secondary mt-3">Volver a la lista</a>
        </div>
    </div>
    
    <!-- Sección de Variantes -->
    {% if prenda.variantes.exists %}
    <div class="row mt-5">
        <div class="col-12">
            <h4>Variantes Disponibles</h4>
            <div class="accordion" id="variantesAccordion">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingVariantes">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseVariantes" aria-expanded="false" aria-controls="collapseVariantes">
                            Ver Variantes ({{ prenda.variantes.count }})
                        </button>
                    </h2>
                    <div id="collapseVariantes" class="accordion-collapse collapse" aria-labelledby="headingVariantes" data-bs-parent="#variantesAccordion">
                        <div class="accordion-body">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>Color</th>
                                            <th>Talla</th>
                                            <th>Cantidad</th>
                                            <th>Estatus</th>
                                            <th>Imagen</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for variante in prenda.variantes.all %}
                                        <tr>
                                            <td>{{ variante.color }}</td>
                                            <td>{{ variante.talla }}</td>
                                            <td>{{ variante.cantidad }}</td>
                                            <td>
                                                <span class="badge {% if variante.estatus == 'disponible' %}bg-success{% elif variante.estatus == 'apartado' %}bg-warning{% else %}bg-danger{% endif %}">
                                                    {{ variante.get_estatus_display }}
                                                </span>
                                            </td>
                                            <td>
                                                {% if variante.imagen %}
                                                    <img src="{{ variante.imagen.url }}" alt="{{ variante.color }} - {{ variante.talla }}" style="width: 50px; height: 50px; object-fit: cover;" class="rounded">
                                                {% else %}
                                                    Sin imagen
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Sección de Unidades Individuales -->
    {% if unidades %}
    <div class="row mt-5">
        <div class="col-12">
            <h4>Unidades Individuales ({{ unidades.count }})</h4>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Número de Serie</th>
                            <th>Variante</th>
                            <th>Estatus</th>
                            <th>Fecha</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for unidad in unidades %}
                        <tr>
                            <td><strong>{{ unidad.numero_serie }}</strong></td>
                            <td>{{ unidad.variante.color }} - {{ unidad.variante.talla }}</td>
                            <td>
                                <span class="badge bg-{% if unidad.estatus == 'disponible' %}success{% elif unidad.estatus == 'apartado' %}warning{% else %}danger{% endif %}">
                                    {{ unidad.get_estatus_display }}
                                </span>
                            </td>
                            <td>{{ unidad.fecha_creacion|date:"d/m/Y" }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}

{% endblock %}